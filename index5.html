<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Konva Kaleidoscope Image Demo</title>
    <link rel="stylesheet" href="styles.css" />
    <script src="https://unpkg.com/konva@8.3.3/konva.min.js"></script>
    <script src="html2canvas.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/handpose"></script>
    <!-- <script src="record.js"></script> -->
    <link rel="stylesheet" href="styles.css" />
</head>
<body>
    <div class="controlPanel" id="controlPanel">
        <!-- Interactive Controls Here -->
        <!-- Buttons and inputs are kept for interactivity -->
        <input
        type="range"
        min="1"
        max="5"
        value="3"
        class="slider"
        id="myRange"
      />


      <button id="button"  onclick="loadTheImage()">Change</button>
      <button onclick="doCapture()">Capture</button>
      <button id="hideShow" onclick="hideLogo()">Toggle</button>
      <input
        type="text"
        id="theImage"
        name="theImage"
        value="images/image_one.jpeg"
      />

      <button id="button" onclick="loadTheImage()">load The Image</button>

      <select id="selectImage" onchange="myFunction()">
        <option value="images/image_one.jpeg">The Moon</option>
        <option value="images/image_two.jpeg">History</option>
        <option value="images/image_three.jpeg">Scary</option>
        <option value="images/image_four.jpeg">Inverted</option>
        <option value="images/image_five.jpeg">URL</option>
        <option value="images/image_six.jpeg">Six</option>
        <option value="images/bahai.jpeg">Bahai</option>
        <option value="images/image_seven.jpeg">Seven</option>
        <option value="images/image_eight.jpeg">Eight</option>
        <option value="images/image_nine.jpeg">Nine</option>
        <option value="images/image_ten.jpeg">Ten</option>
        <option value="images/image_thirteen.jpeg">Thirteen</option>
        <option value="images/image_fourteen.jpeg">Fourteen</option>
        <option value="images/image_15.png">Fifteen</option>
        <option value="images/image_16.png">Sixteen</option>
        
        <!-- <option value="images/cicada.jpeg">cicada</option> -->
        <!-- <option value="images/locust.jpeg">locust</option> -->
      </select>

      <select id="selectOverlay" onchange="changeOverlay()">
        <option value="images/overlay2.png">Figure</option>
        <option value="images/overlay3.png">Guitar</option>
        <option value="images/overlay4.png">More Guitar</option>
        <option value="images/overlay5.png">BLM</option>
        <option value="images/overlay6.png">Full BLM</option>
        <option value="images/overlay7.png">Another</option>
        <option value="images/overlay9.png">CAT</option>
        <option value="images/overlay10.png">CAT</option>
        <option value="images/overlay11.png">Abstract</option>
        <option value="images/overlay11.gif">Experimental</option>
        <option value="images/overlay12.gif">Experimental2</option>
        <option value="images/overlay13.gif">Experimental3</option>
        <option value="images/overlay13.gif">Experimental4</option>
        <option value="images/overlay15.png">Workers1</option>
        <option value="images/overlay16.png">Ape</option>
        <option value="images/overlay17.png">Shut_Down</option>
        <option value="images/huckle.gif">Huckleberry</option>
        
        <!-- <option value="images/cicada.jpeg">cicada</option> -->
        <!-- <option value="images/locust.jpeg">locust</option> -->
      </select>
    <!-- </div> -->
</div>
<img draggable="true "id="topOverlay" src="images/halftonetop1.png" >
<img draggable="true "id="pngOverlay" src="images/bubbles.png" onclick="hideLogo()"  alt="bubbles" onkeydown="doCapture()">
<!-- <img draggable="true "id="pngOverlay1" src="images/overlay8.png" height="100%"  > -->
<img draggable="true "id="bottomOverlay" src="images/halftoneOverlay3.png" height="100%">
<!-- <img draggable="true "id="pngOverlay1" src="images/" onclick="hideLogo()"  alt="bubbles" onkeydown="doCapture()"> -->
    <!-- <div id="container" onkeydown="hideShow()" onmouseover="preRepeatWhileMouseOver(event)"  onclick="doCapture()"> </div>


  </div> -->
   
    </div>
 
       <div id="quote">
      <img id="card" src="images/card0.jpg">
   
        
    </div>
    <img draggable="true "id="topOverlay" src="images/halftonetop1.png" >
<img draggable="true "id="pngOverlay" src="images/bubbles.png" onclick="hideLogo()"  alt="bubbles" onkeydown="doCapture()">
<img draggable="true "id="pngOverlay1" src="images/overlay8.png" height="100%" onclick="hideLogo()"  alt="bubbles" onkeydown="doCapture()">
<img draggable="true "id="bottomOverlay" src="images/halftoneOverlay3.png" height="100%">
    <div id="container"></div>
    <!-- Additional image overlays and interactive elements -->

    <div id="lower_middle">
      <button id="recordAudio" onclick="startRecording()">Record Audio</button>
      <br><br>
      <button class="glow-on-hover" type="button" id="bt9"></button>
      <br><br>
      <button class="glow-on-hover" type="button" id="bt10"></button>
      <br><br>
      <button class="glow-on-hover" type="button" id="bt11"></button>
      <br><br>
      <button class="glow-on-hover" type="button" id="bt12"></button>
  </div>


    <div id="lower_left">
        <button class="glow-on-hover" type="button" id="bt"></button> 
        <br><br>
        <button class="glow-on-hover" type="button" id="bt1"></button> 
        <br><br>
        <button class="glow-on-hover" type="button" id="bt2"></button> 
        <br><br>
        <button class="glow-on-hover" type="button" id="bt3"></button>
         <br><br>
        <button class="glow-on-hover" type="button" id="bt4"></button>
         <br><br>
         <button class="glow-on-hover" type="button" id="bt5"></button>
         <br><br>
         <button class="glow-on-hover" type="button" id="bt6"></button>
         <br><br>
         <button class="glow-on-hover" type="button" id="bt7"></button>
         <br><br>
         <button class="glow-on-hover" type="button" id="bt8"></button>
        </div>
        <!-- <h1>File Copier Tool</h1> -->
        <div id="block"></div>
        <form id="fileForm">
            <input type="file" id="fileInput" required>
            <button type="submit">Copy File</button>
        </form>
        <div id="response"></div>
    
        <script>
            $(document).ready(function() {
                $('#fileForm').on('submit', function(e) {
                    e.preventDefault();
                    var fileInput = document.getElementById('fileInput');
                    console.log(fileInput.files);
                    if (fileInput.files.length > 0) {
                        var file = fileInput.files[0];
                        var formData = new FormData();
                        formData.append("file", file);
    
                        $.ajax({
                            url: 'http://localhost:3000/copyFile',
                            type: 'POST',
                            processData: false, // Prevents jQuery from automatically transforming the data into a query string
                            contentType: false,
                            data: formData,
                            success: function(response) {
                                $('#response').html('<p>' + response + '</p>');
                            },
                            error: function(xhr, status, error) {
                                $('#response').html('<p style="color: red;">Error: ' + xhr.responseText + '</p>');
                            }
                        });
                    } else {
                        $('#response').html('<p style="color: red;">Please select a file to copy.</p>');
                    }
                });
            });
        </script>
</body>
    <script>
        let url=[]
 url = ['images/kicker2.wav','images/kicker13.wav','images/New_weird.wav','images/glow.wav','images/owl.wav','images/cat.m4a','images/ambient_jams.m4a','images/dub_coffee.m4a','images/kicker.wav']
// /Users/reidharward/Desktop/New_weird.wav
 
const my = new Audio(url);

var btn =document.getElementById('bt');
btn.addEventListener('click', function(){
  var audioElement = document.createElement('audio');
 audioElement.setAttribute('src', url[0]);
   playFunc(audioElement, 1);
});

var btn1=document.getElementById('bt1');
btn1.addEventListener('click', function(){
  var audioElement1 = document.createElement('audio');
 audioElement1.setAttribute('src', url[1]);
   playFunc(audioElement1, 1);
});


var btn2=document.getElementById('bt2');
btn2.addEventListener('click', function(){
  var audioElement2 = document.createElement('audio');
 audioElement2.setAttribute('src', url[2]);
   playFunc(audioElement2, 1);
});

var btn3=document.getElementById('bt3');
btn3.addEventListener('click', function(){
  var audioElement3 = document.createElement('audio');
 audioElement3.setAttribute('src', url[3]);
   playFunc(audioElement3, 1);
});

var btn4=document.getElementById('bt4');
btn4.addEventListener('click', function(){
  var audioElement4 = document.createElement('audio');
 audioElement4.setAttribute('src', url[4]);
   playFunc(audioElement4, 1);
});

var btn5=document.getElementById('bt5');
btn5.addEventListener('click', function(){
  var audioElement5 = document.createElement('audio');
 audioElement5.setAttribute('src', url[5]);
   playFunc(audioElement5, 1);
});

var btn6=document.getElementById('bt6');
btn5.addEventListener('click', function(){
  var audioElement6 = document.createElement('audio');
 audioElement6.setAttribute('src', url[6]);
   playFunc(audioElement6, 1);
});

var btn7=document.getElementById('bt7');
btn5.addEventListener('click', function(){
  var audioElement7 = document.createElement('audio');
 audioElement7.setAttribute('src', url[7]);
   playFunc(audioElement7, 1);
});

var btn8=document.getElementById('bt8');
btn8.addEventListener('click', function(){
  var audioElement8 = document.createElement('audio');
 audioElement8.setAttribute('src', url[8]);
   playFunc(audioElement8, 1);
});


function playFunc(target, RepeatCount) {
//btn.disabled=true;
 var soundFunc = function(){
    RepeatCount--;
    target.currentTime = 0;
    if (RepeatCount>0)
        target.play();
    else{
       target.removeEventListener('ended', soundFunc);
        btn.disabled=false;
    }

}
target.addEventListener('ended', soundFunc)
target.play();

}

        async function setupCamera() {
            const video = document.createElement('video');
            const stream = await navigator.mediaDevices.getUserMedia({ video: true });
            video.srcObject = stream;
            return new Promise((resolve) => {
                video.onloadedmetadata = () => { resolve(video); };
            });
        }

        async function loadModel() {
            return await handpose.load();
        }

        async function detectHandPose(video, model) {
            async function frameLandmarks() {
                const predictions = await model.estimateHands(video);
                if (predictions.length > 0) {
                    const indexFingerTip = predictions[0].landmarks[8]; // Index finger tip
                    document.dispatchEvent(new CustomEvent('fingerPositionDetected', { detail: { x: indexFingerTip[0] } }));
                }
                requestAnimationFrame(frameLandmarks);
            }
            frameLandmarks();
        }

        async function main() {
            const video = await setupCamera();
            video.play();
            const model = await loadModel();
            detectHandPose(video, model);
        }

        main();

        document.addEventListener('fingerPositionDetected', (event) => {
            const xPosition = event.detail.x;
            // Use xPosition to control elements
            // Example: Update a slider or apply effects to a Konva image
            if (window.imageHolder && window.imageHolder.kaleidoscopeAngle) {
                window.imageHolder.kaleidoscopeAngle(xPosition);
            }
        });
    </script>
    <script src="script5.js"></script> <!-- Assuming script5.js contains necessary Konva setup -->

</html>
